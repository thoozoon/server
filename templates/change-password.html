<!doctype html>
<html lang="en" class="h-full">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="COMP 3007 Change Password" />
        <title>Change Password | COMP 3007</title>

        {{template "scripts.html" .}} {{template "styles.html" .}}
    </head>
    <body class="h-full bg-white text-gray-900">
        <div class="min-h-full">
            {{template "navigation.html" .}}

            <main>
                <div class="max-w-2xl mx-auto px-4 py-8">
                    <div class="bg-white border border-gray-200 rounded-lg p-8">
                        <div class="mb-8">
                            <h1 class="text-2xl font-semibold text-gray-900 mb-2">Change Password</h1>
                            <p class="text-gray-600">Update your account password</p>
                        </div>

                        {{if .Error}}
                        <div class="mb-6 bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg">
                            <p class="text-sm">{{.Error}}</p>
                        </div>
                        {{end}}

                        {{if .Success}}
                        <div class="mb-6 bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg">
                            <p class="text-sm">{{.Success}}</p>
                        </div>
                        {{end}}

                        <form method="POST" action="/change-password" class="space-y-6">
                            <div>
                                <label for="current_password" class="block text-sm font-medium text-gray-700 mb-2">
                                    Current Password
                                </label>
                                <input
                                    type="password"
                                    id="current_password"
                                    name="current_password"
                                    required
                                    class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white"
                                    placeholder="Enter your current password"
                                    autofocus
                                />
                            </div>

                            <div>
                                <label for="new_password" class="block text-sm font-medium text-gray-700 mb-2">
                                    New Password
                                </label>
                                <input
                                    type="password"
                                    id="new_password"
                                    name="new_password"
                                    required
                                    minlength="8"
                                    class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white"
                                    placeholder="Enter a new secure password"
                                />
                                <p class="mt-1 text-sm text-gray-500">Password must be at least 8 characters long</p>
                            </div>

                            <div>
                                <label for="confirm_password" class="block text-sm font-medium text-gray-700 mb-2">
                                    Confirm New Password
                                </label>
                                <input
                                    type="password"
                                    id="confirm_password"
                                    name="confirm_password"
                                    required
                                    minlength="8"
                                    class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white"
                                    placeholder="Confirm your new password"
                                />
                            </div>

                            <div class="flex gap-4">
                                <button
                                    type="submit"
                                    class="flex-1 py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                                >
                                    Update Password
                                </button>
                                <a
                                    href="/"
                                    class="flex-1 py-3 px-4 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 text-center"
                                >
                                    Cancel
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </main>
        </div>

        <script>
            // Password confirmation validation
            document.addEventListener("DOMContentLoaded", function () {
                const form = document.querySelector("form");
                const currentPasswordField = document.getElementById("current_password");
                const newPasswordField = document.getElementById("new_password");
                const confirmPasswordField = document.getElementById("confirm_password");

                // Auto-focus current password field
                currentPasswordField.focus();

                // Real-time password confirmation validation
                function validatePasswordMatch() {
                    if (confirmPasswordField.value && newPasswordField.value !== confirmPasswordField.value) {
                        confirmPasswordField.setCustomValidity("Passwords do not match");
                        confirmPasswordField.classList.add("border-red-300", "focus:border-red-500", "focus:ring-red-500");
                        confirmPasswordField.classList.remove("border-gray-200", "focus:border-blue-500", "focus:ring-blue-500");
                    } else {
                        confirmPasswordField.setCustomValidity("");
                        confirmPasswordField.classList.remove("border-red-300", "focus:border-red-500", "focus:ring-red-500");
                        confirmPasswordField.classList.add("border-gray-200", "focus:border-blue-500", "focus:ring-blue-500");
                    }
                }

                // Validate that new password is different from current
                function validateNewPassword() {
                    if (newPasswordField.value && currentPasswordField.value === newPasswordField.value) {
                        newPasswordField.setCustomValidity("New password must be different from current password");
                        newPasswordField.classList.add("border-red-300", "focus:border-red-500", "focus:ring-red-500");
                        newPasswordField.classList.remove("border-gray-200", "focus:border-blue-500", "focus:ring-blue-500");
                    } else {
                        newPasswordField.setCustomValidity("");
                        newPasswordField.classList.remove("border-red-300", "focus:border-red-500", "focus:ring-red-500");
                        newPasswordField.classList.add("border-gray-200", "focus:border-blue-500", "focus:ring-blue-500");
                    }
                }

                currentPasswordField.addEventListener("input", validateNewPassword);
                newPasswordField.addEventListener("input", function() {
                    validateNewPassword();
                    validatePasswordMatch();
                });
                confirmPasswordField.addEventListener("input", validatePasswordMatch);

                // Handle form submission
                form.addEventListener("submit", function (e) {
                    if (newPasswordField.value !== confirmPasswordField.value) {
                        e.preventDefault();
                        confirmPasswordField.focus();
                        return;
                    }

                    if (currentPasswordField.value === newPasswordField.value) {
                        e.preventDefault();
                        newPasswordField.focus();
                        return;
                    }

                    const submitButton = this.querySelector('button[type="submit"]');
                    submitButton.disabled = true;
                    submitButton.textContent = "Updating Password...";
                });
            });
        </script>
    </body>
</html>
